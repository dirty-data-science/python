
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="Dirty categories: learning with non normalized entries" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://dirtydata.science/gen_notes/02_dirty_categories.html" />
  <meta property="og:site_name" content="Dirty Data Science" />
  <meta property="og:description" content="Including strings that represent categories often calls for much data preparation. In particular categories may appear with many morphological variants, when they have been manually input, or assem..." />
  <meta property="og:image" content="../_images/sphx_glr_02_dirty_categories_001.png" />
  <meta property="og:image:alt" content="Feature importances" />
  
    <title>Dirty categories: learning with non normalized entries &#8212; &amp;mdash; Dirty data science</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Machine learning with missing values" href="01_missing_values.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/piggy.svg" alt="Logo"/>
    
    <h1 class="logo logo-name">Dirty data science</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=dirty-data-science&repo=python&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Dirty categories: learning with non normalized entries</a><ul>
<li><a class="reference internal" href="#the-data">The data</a><ul>
<li><a class="reference internal" href="#data-importing-and-preprocessing">Data Importing and preprocessing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#assembling-a-machine-learning-pipeline-that-encodes-the-data">Assembling a machine-learning pipeline that encodes the data</a><ul>
<li><a class="reference internal" href="#the-learning-pipeline">The learning pipeline</a><ul>
<li><a class="reference internal" href="#the-categorical-encoders">The categorical encoders</a></li>
<li><a class="reference internal" href="#the-prediction-pipeline">The prediction pipeline</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prediction-performance-for-supervised-learning">Prediction performance for supervised learning</a></li>
<li><a class="reference internal" href="#plot-the-results">Plot the results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#automatic-vectorization">Automatic vectorization</a><ul>
<li><a class="reference internal" href="#using-the-supervectorizer-in-a-supervised-learning-pipeline">Using the SuperVectorizer in a supervised-learning pipeline</a></li>
<li><a class="reference internal" href="#analyzing-the-features-created">Analyzing the features created</a><ul>
<li><a class="reference internal" href="#inspecting-the-features-created">Inspecting the features created</a></li>
</ul>
</li>
<li><a class="reference internal" href="#feature-importance-in-the-statistical-model">Feature importance in the statistical model</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="01_missing_values.html" title="previous chapter">Machine learning with missing values</a></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-gen-notes-02-dirty-categories-py"><span class="std std-ref">here</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<div class="sphx-glr-example-title section" id="dirty-categories-learning-with-non-normalized-entries">
<span id="sphx-glr-gen-notes-02-dirty-categories-py"></span><h1>Dirty categories: learning with non normalized entries<a class="headerlink" href="#dirty-categories-learning-with-non-normalized-entries" title="Permalink to this headline">¶</a></h1>
<p>Including strings that represent categories often calls for much data
preparation. In particular categories may appear with many morphological
variants, when they have been manually input, or assembled from diverse
sources.</p>
<p>Including such a column in a learning pipeline as a standard categorical
colum leads to categories with very high cardinalities and can loose
information on which categories are similar.</p>
<p>Here we look at a dataset on wages <a class="footnote-reference brackets" href="#id2" id="id1">1</a> where the column <em>Employee
Position Title</em> contains dirty categories.</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="https://catalog.data.gov/dataset/employee-salaries-2016">https://catalog.data.gov/dataset/employee-salaries-2016</a></p>
</dd>
</dl>
<p>We investigate encodings to include such compare different categorical
encodings for the dirty column to predict the <em>Current Annual Salary</em>,
using gradient boosted trees.</p>
<div class="section" id="the-data">
<h2>The data<a class="headerlink" href="#the-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="data-importing-and-preprocessing">
<h3>Data Importing and preprocessing<a class="headerlink" href="#data-importing-and-preprocessing" title="Permalink to this headline">¶</a></h3>
<p>We first download the dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dirty_cat.datasets</span> <span class="kn">import</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.datasets.fetch_employee_salaries.html#dirty_cat.datasets.fetch_employee_salaries" title="dirty_cat.datasets.fetch_employee_salaries" class="sphx-glr-backref-module-dirty_cat-datasets sphx-glr-backref-type-py-function"><span class="n">fetch_employee_salaries</span></a>
<span class="n">employee_salaries</span> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.datasets.fetch_employee_salaries.html#dirty_cat.datasets.fetch_employee_salaries" title="dirty_cat.datasets.fetch_employee_salaries" class="sphx-glr-backref-module-dirty_cat-datasets sphx-glr-backref-type-py-function"><span class="n">fetch_employee_salaries</span></a><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">employee_salaries</span><span class="p">[</span><span class="s1">&#39;DESCR&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Annual salary information including gross pay and overtime pay for all active, permanent employees of Montgomery County, MD paid in calendar year 2016. This information will be published annually each year.

Downloaded from openml.org.
</pre></div>
</div>
<p>Then we load it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a> <span class="o">=</span> <span class="n">employee_salaries</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>full_name</th>
      <th>gender</th>
      <th>2016_gross_pay_received</th>
      <th>2016_overtime_pay</th>
      <th>department</th>
      <th>department_name</th>
      <th>division</th>
      <th>assignment_category</th>
      <th>employee_position_title</th>
      <th>underfilled_job_title</th>
      <th>date_first_hired</th>
      <th>year_first_hired</th>
      <th>Current Annual Salary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aarhus, Pam J.</td>
      <td>F</td>
      <td>71225.98</td>
      <td>416.10</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>MSB Information Mgmt and Tech Division Records...</td>
      <td>Fulltime-Regular</td>
      <td>Office Services Coordinator</td>
      <td>None</td>
      <td>09/22/1986</td>
      <td>1986.0</td>
      <td>69222.18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Aaron, David J.</td>
      <td>M</td>
      <td>103088.48</td>
      <td>3326.19</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>ISB Major Crimes Division Fugitive Section</td>
      <td>Fulltime-Regular</td>
      <td>Master Police Officer</td>
      <td>None</td>
      <td>09/12/1988</td>
      <td>1988.0</td>
      <td>97392.47</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Aaron, Marsha M.</td>
      <td>F</td>
      <td>107000.24</td>
      <td>1353.32</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>Adult Protective and Case Management Services</td>
      <td>Fulltime-Regular</td>
      <td>Social Worker IV</td>
      <td>None</td>
      <td>11/19/1989</td>
      <td>1989.0</td>
      <td>104717.28</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Ababio, Godfred A.</td>
      <td>M</td>
      <td>57819.04</td>
      <td>3423.07</td>
      <td>COR</td>
      <td>Correction and Rehabilitation</td>
      <td>PRRS Facility and Security</td>
      <td>Fulltime-Regular</td>
      <td>Resident Supervisor II</td>
      <td>None</td>
      <td>05/05/2014</td>
      <td>2014.0</td>
      <td>52734.57</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Ababu, Essayas</td>
      <td>M</td>
      <td>95815.17</td>
      <td>NaN</td>
      <td>HCA</td>
      <td>Department of Housing and Community Affairs</td>
      <td>Affordable Housing Programs</td>
      <td>Fulltime-Regular</td>
      <td>Planning Specialist III</td>
      <td>None</td>
      <td>03/05/2007</td>
      <td>2007.0</td>
      <td>93396.00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9223</th>
      <td>Zurita, Justina</td>
      <td>F</td>
      <td>58154.47</td>
      <td>NaN</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>School Based Health Centers</td>
      <td>Fulltime-Regular</td>
      <td>Community Health Nurse II</td>
      <td>None</td>
      <td>11/03/2015</td>
      <td>2015.0</td>
      <td>72094.53</td>
    </tr>
    <tr>
      <th>9224</th>
      <td>Zuspan, Diane M.</td>
      <td>F</td>
      <td>173173.01</td>
      <td>956.97</td>
      <td>FRS</td>
      <td>Fire and Rescue Services</td>
      <td>Human Resources Division</td>
      <td>Fulltime-Regular</td>
      <td>Fire/Rescue Division Chief</td>
      <td>None</td>
      <td>11/28/1988</td>
      <td>1988.0</td>
      <td>169543.85</td>
    </tr>
    <tr>
      <th>9225</th>
      <td>Zwerdling, David</td>
      <td>M</td>
      <td>104238.18</td>
      <td>NaN</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>Child and Adolescent Mental Health Clinic Serv...</td>
      <td>Parttime-Regular</td>
      <td>Medical Doctor IV - Psychiatrist</td>
      <td>None</td>
      <td>04/30/2001</td>
      <td>2001.0</td>
      <td>102736.52</td>
    </tr>
    <tr>
      <th>9226</th>
      <td>Zyontz, Jeffrey L.</td>
      <td>M</td>
      <td>149105.25</td>
      <td>NaN</td>
      <td>CCL</td>
      <td>County Council</td>
      <td>Council Central Staff</td>
      <td>Fulltime-Regular</td>
      <td>Manager II</td>
      <td>None</td>
      <td>09/05/2006</td>
      <td>2006.0</td>
      <td>153747.50</td>
    </tr>
    <tr>
      <th>9227</th>
      <td>Zywiolek, Tim R.</td>
      <td>M</td>
      <td>74975.53</td>
      <td>NaN</td>
      <td>DLC</td>
      <td>Department of Liquor Control</td>
      <td>Licensure, Regulation and Education</td>
      <td>Fulltime-Regular</td>
      <td>Alcohol/Tobacco Enforcement Specialist II</td>
      <td>None</td>
      <td>01/30/2012</td>
      <td>2012.0</td>
      <td>75484.08</td>
    </tr>
  </tbody>
</table>
<p>9228 rows × 13 columns</p>
</div>
</div>
<br />
<br /><p>Now, let’s carry out some basic preprocessing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">[</span><span class="s1">&#39;Date First Hired&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-function"><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span></a><span class="p">(</span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">[</span><span class="s1">&#39;date_first_hired&#39;</span><span class="p">])</span>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">[</span><span class="s1">&#39;Year First Hired&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">[</span><span class="s1">&#39;Date First Hired&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="c1"># drop rows with NaN in gender</span>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dropna.html#pandas.DataFrame.dropna" title="pandas.DataFrame.dropna" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-method"><span class="n">df</span><span class="o">.</span><span class="n">dropna</span></a><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>First we extract the target</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_column</span></a> <span class="o">=</span> <span class="s1">&#39;Current Annual Salary&#39;</span>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a> <span class="o">=</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target_column</span></a><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="assembling-a-machine-learning-pipeline-that-encodes-the-data">
<h2>Assembling a machine-learning pipeline that encodes the data<a class="headerlink" href="#assembling-a-machine-learning-pipeline-that-encodes-the-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-learning-pipeline">
<h3>The learning pipeline<a class="headerlink" href="#the-learning-pipeline" title="Permalink to this headline">¶</a></h3>
<p>To build a learning pipeline, we need to assemble encoders for each
column, and apply a supvervised learning model on top.</p>
<div class="section" id="the-categorical-encoders">
<h4>The categorical encoders<a class="headerlink" href="#the-categorical-encoders" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>For the encoders for both clean and dirty data:</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class"><span class="n">OneHotEncoder</span></a>
<span class="kn">from</span> <span class="nn">dirty_cat</span> <span class="kn">import</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SimilarityEncoder.html#dirty_cat.SimilarityEncoder" title="dirty_cat.SimilarityEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">SimilarityEncoder</span></a><span class="p">,</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.TargetEncoder.html#dirty_cat.TargetEncoder" title="dirty_cat.TargetEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">TargetEncoder</span></a><span class="p">,</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.MinHashEncoder.html#dirty_cat.MinHashEncoder" title="dirty_cat.MinHashEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">MinHashEncoder</span></a><span class="p">,</span>\
    <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.GapEncoder.html#dirty_cat.GapEncoder" title="dirty_cat.GapEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">GapEncoder</span></a>

<a href="http://scikit-learn.org/0.20/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_hot</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class"><span class="n">OneHotEncoder</span></a><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SimilarityEncoder.html#dirty_cat.SimilarityEncoder" title="dirty_cat.SimilarityEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">similarity</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SimilarityEncoder.html#dirty_cat.SimilarityEncoder" title="dirty_cat.SimilarityEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">SimilarityEncoder</span></a><span class="p">(</span><a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SimilarityEncoder.html#dirty_cat.SimilarityEncoder" title="dirty_cat.SimilarityEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">similarity</span></a><span class="o">=</span><span class="s1">&#39;ngram&#39;</span><span class="p">)</span>
<a href="https://dirty-cat.github.io/stable/generated/dirty_cat.TargetEncoder.html#dirty_cat.TargetEncoder" title="dirty_cat.TargetEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.TargetEncoder.html#dirty_cat.TargetEncoder" title="dirty_cat.TargetEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">TargetEncoder</span></a><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<a href="https://dirty-cat.github.io/stable/generated/dirty_cat.MinHashEncoder.html#dirty_cat.MinHashEncoder" title="dirty_cat.MinHashEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">minhash</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.MinHashEncoder.html#dirty_cat.MinHashEncoder" title="dirty_cat.MinHashEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">MinHashEncoder</span></a><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a href="https://dirty-cat.github.io/stable/generated/dirty_cat.GapEncoder.html#dirty_cat.GapEncoder" title="dirty_cat.GapEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gap</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.GapEncoder.html#dirty_cat.GapEncoder" title="dirty_cat.GapEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">GapEncoder</span></a><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">encoder_names</span></a> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;one-hot&#39;</span><span class="p">:</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_hot</span></a><span class="p">,</span>
    <span class="s1">&#39;similarity&#39;</span><span class="p">:</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SimilarityEncoder.html#dirty_cat.SimilarityEncoder" title="dirty_cat.SimilarityEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">SimilarityEncoder</span></a><span class="p">(</span><a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SimilarityEncoder.html#dirty_cat.SimilarityEncoder" title="dirty_cat.SimilarityEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">similarity</span></a><span class="o">=</span><span class="s1">&#39;ngram&#39;</span><span class="p">),</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.TargetEncoder.html#dirty_cat.TargetEncoder" title="dirty_cat.TargetEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">target</span></a><span class="p">,</span>
    <span class="s1">&#39;minhash&#39;</span><span class="p">:</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.MinHashEncoder.html#dirty_cat.MinHashEncoder" title="dirty_cat.MinHashEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">minhash</span></a><span class="p">,</span>
    <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.GapEncoder.html#dirty_cat.GapEncoder" title="dirty_cat.GapEncoder" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gap</span></a><span class="p">}</span>
</pre></div>
</div>
<p>We assemble these to be applied on the relevant columns</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.compose.make_column_transformer.html#sklearn.compose.make_column_transformer" title="sklearn.compose.make_column_transformer" class="sphx-glr-backref-module-sklearn-compose sphx-glr-backref-type-py-function"><span class="n">make_column_transformer</span></a>
<a href="http://scikit-learn.org/0.20/modules/generated/sklearn.compose.ColumnTransformer.html#sklearn.compose.ColumnTransformer" title="sklearn.compose.ColumnTransformer" class="sphx-glr-backref-module-sklearn-compose sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">encoder</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.compose.make_column_transformer.html#sklearn.compose.make_column_transformer" title="sklearn.compose.make_column_transformer" class="sphx-glr-backref-module-sklearn-compose sphx-glr-backref-type-py-function"><span class="n">make_column_transformer</span></a><span class="p">(</span>
    <span class="p">(</span><a href="http://scikit-learn.org/0.20/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_hot</span></a><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;department_name&#39;</span><span class="p">,</span> <span class="s1">&#39;assignment_category&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="s1">&#39;passthrough&#39;</span><span class="p">,</span> <span class="s1">&#39;Year First Hired&#39;</span><span class="p">),</span>
    <span class="c1"># Last but not least, our dirty column</span>
    <span class="p">(</span><span class="s1">&#39;employee_position_title&#39;</span><span class="p">,</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="sklearn.preprocessing.OneHotEncoder" class="sphx-glr-backref-module-sklearn-preprocessing sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">one_hot</span></a><span class="p">),</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s1">&#39;drop&#39;</span><span class="p">,</span>
   <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-prediction-pipeline">
<h4>The prediction pipeline<a class="headerlink" href="#the-prediction-pipeline" title="Permalink to this headline">¶</a></h4>
<p>We will use a HistGradientBoostingRegressor, which is a good predictor
for data with heterogeneous columns
(for scikit-learn 0.24 we need to require the experimental feature)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_hist_gradient_boosting</span>  <span class="c1"># noqa</span>
<span class="c1"># now you can import normally from ensemble</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class"><span class="n">HistGradientBoostingRegressor</span></a>

<span class="c1"># We then create a pipeline chaining our encoders to a learner</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.pipeline.make_pipeline.html#sklearn.pipeline.make_pipeline" title="sklearn.pipeline.make_pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-function"><span class="n">make_pipeline</span></a>
<a href="http://scikit-learn.org/0.20/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pipeline</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.pipeline.make_pipeline.html#sklearn.pipeline.make_pipeline" title="sklearn.pipeline.make_pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-function"><span class="n">make_pipeline</span></a><span class="p">(</span><a href="http://scikit-learn.org/0.20/modules/generated/sklearn.compose.ColumnTransformer.html#sklearn.compose.ColumnTransformer" title="sklearn.compose.ColumnTransformer" class="sphx-glr-backref-module-sklearn-compose sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">encoder</span></a><span class="p">,</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class"><span class="n">HistGradientBoostingRegressor</span></a><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/varoquau/dev/scikit-learn/sklearn/experimental/enable_hist_gradient_boosting.py:16: UserWarning: Since version 1.0, it is not needed to import enable_hist_gradient_boosting anymore. HistGradientBoostingClassifier and HistGradientBoostingRegressor are now stable and can be normally imported from sklearn.ensemble.
  warnings.warn(
</pre></div>
</div>
</div>
</div>
<div class="section" id="prediction-performance-for-supervised-learning">
<h3>Prediction performance for supervised learning<a class="headerlink" href="#prediction-performance-for-supervised-learning" title="Permalink to this headline">¶</a></h3>
<p>Eventually, we loop over the different encoding methods,
instantiate each time a new pipeline, fit it
and store the returned cross-validation score:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="sklearn.model_selection.cross_val_score" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">cross_val_score</span></a>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="sklearn.model_selection.cross_val_score" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">cross_val_score</span></a><span class="p">(</span><a href="http://scikit-learn.org/0.20/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pipeline</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">df</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;one-ot encoding&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r2 score:  mean: </span><span class="si">{:.3f}</span><span class="s1">; std: </span><span class="si">{:.3f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <a href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">),</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.std.html#numpy.std" title="numpy.std" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">std</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">)))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py:669: FitFailedWarning: Estimator fit failed. The score on this train-test partition for these parameters will be set to nan. Details:
Traceback (most recent call last):
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py&quot;, line 652, in _fit_and_score
    estimator.fit(X_train, y_train, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 357, in fit
    Xt = self._fit(X, y, **fit_params_steps)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 315, in _fit
    X, fitted_transformer = fit_transform_one_cached(
  File &quot;/usr/lib/python3/dist-packages/joblib/memory.py&quot;, line 352, in __call__
    return self.func(*args, **kwargs)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 767, in _fit_transform_one
    res = transformer.fit_transform(X, y, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 557, in fit_transform
    self._validate_transformers()
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 318, in _validate_transformers
    raise TypeError(
TypeError: All estimators should implement fit and transform, or can be &#39;drop&#39; or &#39;passthrough&#39; specifiers. &#39;employee_position_title&#39; (type &lt;class &#39;str&#39;&gt;) doesn&#39;t.

  warnings.warn(
/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py:669: FitFailedWarning: Estimator fit failed. The score on this train-test partition for these parameters will be set to nan. Details:
Traceback (most recent call last):
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py&quot;, line 652, in _fit_and_score
    estimator.fit(X_train, y_train, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 357, in fit
    Xt = self._fit(X, y, **fit_params_steps)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 315, in _fit
    X, fitted_transformer = fit_transform_one_cached(
  File &quot;/usr/lib/python3/dist-packages/joblib/memory.py&quot;, line 352, in __call__
    return self.func(*args, **kwargs)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 767, in _fit_transform_one
    res = transformer.fit_transform(X, y, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 557, in fit_transform
    self._validate_transformers()
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 318, in _validate_transformers
    raise TypeError(
TypeError: All estimators should implement fit and transform, or can be &#39;drop&#39; or &#39;passthrough&#39; specifiers. &#39;employee_position_title&#39; (type &lt;class &#39;str&#39;&gt;) doesn&#39;t.

  warnings.warn(
/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py:669: FitFailedWarning: Estimator fit failed. The score on this train-test partition for these parameters will be set to nan. Details:
Traceback (most recent call last):
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py&quot;, line 652, in _fit_and_score
    estimator.fit(X_train, y_train, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 357, in fit
    Xt = self._fit(X, y, **fit_params_steps)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 315, in _fit
    X, fitted_transformer = fit_transform_one_cached(
  File &quot;/usr/lib/python3/dist-packages/joblib/memory.py&quot;, line 352, in __call__
    return self.func(*args, **kwargs)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 767, in _fit_transform_one
    res = transformer.fit_transform(X, y, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 557, in fit_transform
    self._validate_transformers()
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 318, in _validate_transformers
    raise TypeError(
TypeError: All estimators should implement fit and transform, or can be &#39;drop&#39; or &#39;passthrough&#39; specifiers. &#39;employee_position_title&#39; (type &lt;class &#39;str&#39;&gt;) doesn&#39;t.

  warnings.warn(
/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py:669: FitFailedWarning: Estimator fit failed. The score on this train-test partition for these parameters will be set to nan. Details:
Traceback (most recent call last):
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py&quot;, line 652, in _fit_and_score
    estimator.fit(X_train, y_train, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 357, in fit
    Xt = self._fit(X, y, **fit_params_steps)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 315, in _fit
    X, fitted_transformer = fit_transform_one_cached(
  File &quot;/usr/lib/python3/dist-packages/joblib/memory.py&quot;, line 352, in __call__
    return self.func(*args, **kwargs)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 767, in _fit_transform_one
    res = transformer.fit_transform(X, y, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 557, in fit_transform
    self._validate_transformers()
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 318, in _validate_transformers
    raise TypeError(
TypeError: All estimators should implement fit and transform, or can be &#39;drop&#39; or &#39;passthrough&#39; specifiers. &#39;employee_position_title&#39; (type &lt;class &#39;str&#39;&gt;) doesn&#39;t.

  warnings.warn(
/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py:669: FitFailedWarning: Estimator fit failed. The score on this train-test partition for these parameters will be set to nan. Details:
Traceback (most recent call last):
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/model_selection/_validation.py&quot;, line 652, in _fit_and_score
    estimator.fit(X_train, y_train, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 357, in fit
    Xt = self._fit(X, y, **fit_params_steps)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 315, in _fit
    X, fitted_transformer = fit_transform_one_cached(
  File &quot;/usr/lib/python3/dist-packages/joblib/memory.py&quot;, line 352, in __call__
    return self.func(*args, **kwargs)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/pipeline.py&quot;, line 767, in _fit_transform_one
    res = transformer.fit_transform(X, y, **fit_params)
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 557, in fit_transform
    self._validate_transformers()
  File &quot;/home/varoquau/dev/scikit-learn/sklearn/compose/_column_transformer.py&quot;, line 318, in _validate_transformers
    raise TypeError(
TypeError: All estimators should implement fit and transform, or can be &#39;drop&#39; or &#39;passthrough&#39; specifiers. &#39;employee_position_title&#39; (type &lt;class &#39;str&#39;&gt;) doesn&#39;t.

  warnings.warn(
one-ot encoding
r2 score:  mean: nan; std: nan
</pre></div>
</div>
<p><strong>Exercise</strong>: now try out the different categorical encoders for our
dirty categorical column. Make sure to store the scores (for instance
in a dictionary) for plotting later</p>
</div>
<div class="section" id="plot-the-results">
<h3>Plot the results<a class="headerlink" href="#plot-the-results" title="Permalink to this headline">¶</a></h3>
<p>Plot the prediction scores using seaborn</p>
<p>What’s the dominant trend? What characterizes the strategies that work
best?</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="automatic-vectorization">
<h2>Automatic vectorization<a class="headerlink" href="#automatic-vectorization" title="Permalink to this headline">¶</a></h2>
<p>Let’s start again from the raw data, but this time well use an
automated way of encoding the data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a> <span class="o">=</span> <span class="n">employee_salaries</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a> <span class="o">=</span> <span class="n">employee_salaries</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We’ll drop a few columns we don’t want</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html#pandas.DataFrame.drop" title="pandas.DataFrame.drop" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-method"><span class="n">X</span><span class="o">.</span><span class="n">drop</span></a><span class="p">(</span>
    <span class="p">[</span>
        <span class="s1">&#39;Current Annual Salary&#39;</span><span class="p">,</span>  <span class="c1"># Too linked with target</span>
        <span class="s1">&#39;full_name&#39;</span><span class="p">,</span>  <span class="c1"># Not relevant to the analysis</span>
        <span class="s1">&#39;2016_gross_pay_received&#39;</span><span class="p">,</span>  <span class="c1"># Too linked with target</span>
        <span class="s1">&#39;2016_overtime_pay&#39;</span><span class="p">,</span>  <span class="c1"># Too linked with target</span>
        <span class="s1">&#39;date_first_hired&#39;</span>  <span class="c1"># Redundant with &quot;year_first_hired&quot;</span>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We have a fairly complex and heterogeneous dataframe:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>department</th>
      <th>department_name</th>
      <th>division</th>
      <th>assignment_category</th>
      <th>employee_position_title</th>
      <th>underfilled_job_title</th>
      <th>year_first_hired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>MSB Information Mgmt and Tech Division Records...</td>
      <td>Fulltime-Regular</td>
      <td>Office Services Coordinator</td>
      <td>None</td>
      <td>1986.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>M</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>ISB Major Crimes Division Fugitive Section</td>
      <td>Fulltime-Regular</td>
      <td>Master Police Officer</td>
      <td>None</td>
      <td>1988.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>F</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>Adult Protective and Case Management Services</td>
      <td>Fulltime-Regular</td>
      <td>Social Worker IV</td>
      <td>None</td>
      <td>1989.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>M</td>
      <td>COR</td>
      <td>Correction and Rehabilitation</td>
      <td>PRRS Facility and Security</td>
      <td>Fulltime-Regular</td>
      <td>Resident Supervisor II</td>
      <td>None</td>
      <td>2014.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>M</td>
      <td>HCA</td>
      <td>Department of Housing and Community Affairs</td>
      <td>Affordable Housing Programs</td>
      <td>Fulltime-Regular</td>
      <td>Planning Specialist III</td>
      <td>None</td>
      <td>2007.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9223</th>
      <td>F</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>School Based Health Centers</td>
      <td>Fulltime-Regular</td>
      <td>Community Health Nurse II</td>
      <td>None</td>
      <td>2015.0</td>
    </tr>
    <tr>
      <th>9224</th>
      <td>F</td>
      <td>FRS</td>
      <td>Fire and Rescue Services</td>
      <td>Human Resources Division</td>
      <td>Fulltime-Regular</td>
      <td>Fire/Rescue Division Chief</td>
      <td>None</td>
      <td>1988.0</td>
    </tr>
    <tr>
      <th>9225</th>
      <td>M</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>Child and Adolescent Mental Health Clinic Serv...</td>
      <td>Parttime-Regular</td>
      <td>Medical Doctor IV - Psychiatrist</td>
      <td>None</td>
      <td>2001.0</td>
    </tr>
    <tr>
      <th>9226</th>
      <td>M</td>
      <td>CCL</td>
      <td>County Council</td>
      <td>Council Central Staff</td>
      <td>Fulltime-Regular</td>
      <td>Manager II</td>
      <td>None</td>
      <td>2006.0</td>
    </tr>
    <tr>
      <th>9227</th>
      <td>M</td>
      <td>DLC</td>
      <td>Department of Liquor Control</td>
      <td>Licensure, Regulation and Education</td>
      <td>Fulltime-Regular</td>
      <td>Alcohol/Tobacco Enforcement Specialist II</td>
      <td>None</td>
      <td>2012.0</td>
    </tr>
  </tbody>
</table>
<p>9228 rows × 8 columns</p>
</div>
</div>
<br />
<br /><p>The challenge is to turn this dataframe into a form suited for
machine learning.</p>
<div class="section" id="using-the-supervectorizer-in-a-supervised-learning-pipeline">
<h3>Using the SuperVectorizer in a supervised-learning pipeline<a class="headerlink" href="#using-the-supervectorizer-in-a-supervised-learning-pipeline" title="Permalink to this headline">¶</a></h3>
<p>Assembling the <a class="reference external" href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer" title="(in dirty_cat v0.2.0a1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SuperVectorizer</span></code></a> in a pipeline with a powerful learner,
such as gradient boosted trees, gives <strong>a machine-learning method that
can be readily applied to the dataframe</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The supervectorizer requires dirty_cat 0.2.0a1. If you have an older</span>
<span class="c1"># version, you can install the alpha release with</span>
<span class="c1">#</span>
<span class="c1">#   pip install -pre dirty_cat==0.2.0a1</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">dirty_cat</span> <span class="kn">import</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer" title="dirty_cat.SuperVectorizer" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">SuperVectorizer</span></a>

<a href="http://scikit-learn.org/0.20/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pipeline</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.pipeline.make_pipeline.html#sklearn.pipeline.make_pipeline" title="sklearn.pipeline.make_pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-function"><span class="n">make_pipeline</span></a><span class="p">(</span>
    <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer" title="dirty_cat.SuperVectorizer" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">SuperVectorizer</span></a><span class="p">(</span><span class="n">auto_cast</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class"><span class="n">HistGradientBoostingRegressor</span></a><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let’s perform a cross-validation to see how well this model predicts</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="sklearn.model_selection.cross_val_score" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">cross_val_score</span></a>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.model_selection.cross_val_score.html#sklearn.model_selection.cross_val_score" title="sklearn.model_selection.cross_val_score" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">cross_val_score</span></a><span class="p">(</span><a href="http://scikit-learn.org/0.20/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">pipeline</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mean=</span><span class="si">{</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.mean.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;std=</span><span class="si">{</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.std.html#numpy.std" title="numpy.std" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">std</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">scores</span></a><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>scores=array([0.88561269, 0.83760419, 0.89255637, 0.91054519, 0.92222249])
mean=0.8897081885442703
std=0.029089765011896567
</pre></div>
</div>
<p>The prediction perform here is pretty much as good as above
but the code here is much simpler as it does not involve specifying
columns manually.</p>
</div>
<div class="section" id="analyzing-the-features-created">
<h3>Analyzing the features created<a class="headerlink" href="#analyzing-the-features-created" title="Permalink to this headline">¶</a></h3>
<p>Let us perform the same workflow, but without the <cite>Pipeline</cite>, so we can
analyze its mechanisms along the way.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer" title="dirty_cat.SuperVectorizer" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sup_vec</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer" title="dirty_cat.SuperVectorizer" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-class"><span class="n">SuperVectorizer</span></a><span class="p">(</span><span class="n">auto_cast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We split the data between train and test, and transform them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.model_selection.train_test_split.html#sklearn.model_selection.train_test_split" title="sklearn.model_selection.train_test_split" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">train_test_split</span></a>
<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_train</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_test</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y_train</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y_test</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.model_selection.train_test_split.html#sklearn.model_selection.train_test_split" title="sklearn.model_selection.train_test_split" class="sphx-glr-backref-module-sklearn-model_selection sphx-glr-backref-type-py-function"><span class="n">train_test_split</span></a><span class="p">(</span>
    <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_train_enc</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer.fit_transform" title="dirty_cat.SuperVectorizer.fit_transform" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-method"><span class="n">sup_vec</span><span class="o">.</span><span class="n">fit_transform</span></a><span class="p">(</span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_train</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y_train</span></a><span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_test_enc</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer.transform" title="dirty_cat.SuperVectorizer.transform" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-method"><span class="n">sup_vec</span><span class="o">.</span><span class="n">transform</span></a><span class="p">(</span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_test</span></a><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="inspecting-the-features-created">
<h4>Inspecting the features created<a class="headerlink" href="#inspecting-the-features-created" title="Permalink to this headline">¶</a></h4>
<p>Once it has been trained on data,
we can print the transformers and the columns assignment it creates:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sup_vec</span><span class="o">.</span><span class="n">transformers_</span></a>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[(&#39;high_card_str&#39;, GapEncoder(), [&#39;division&#39;, &#39;employee_position_title&#39;, &#39;underfilled_job_title&#39;]), (&#39;low_card_cat&#39;, OneHotEncoder(), [&#39;gender&#39;, &#39;assignment_category&#39;]), (&#39;high_card_cat&#39;, GapEncoder(), [&#39;department&#39;, &#39;department_name&#39;]), (&#39;remainder&#39;, &#39;passthrough&#39;, [7])]
</pre></div>
</div>
<p>This is what is being passed to the <a class="reference external" href="https://scikit-learn.org/0.20/modules/generated/sklearn.compose.ColumnTransformer.html#sklearn.compose.ColumnTransformer" title="(in scikit-learn v0.20.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnTransformer</span></code></a> under the hood.
If you’re familiar with how the later works, it should be very intuitive.
We can notice it classified the columns “gender” and “assignment_category”
as low cardinality string variables.
A <a class="reference external" href="https://scikit-learn.org/0.20/modules/generated/sklearn.preprocessing.OneHotEncoder.html#sklearn.preprocessing.OneHotEncoder" title="(in scikit-learn v0.20.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneHotEncoder</span></code></a> will be applied to these columns.</p>
<p>The vectorizer actually makes the difference between string variables
(data type <code class="docutils literal notranslate"><span class="pre">object</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>) and categorical variables
(data type <code class="docutils literal notranslate"><span class="pre">category</span></code>).</p>
<p>Next, we can have a look at the encoded feature names.</p>
<p>Before encoding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Index.to_list.html#pandas.Index.to_list" title="pandas.Index.to_list" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-method"><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span></a><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;gender&#39;, &#39;department&#39;, &#39;department_name&#39;, &#39;division&#39;, &#39;assignment_category&#39;, &#39;employee_position_title&#39;, &#39;underfilled_job_title&#39;, &#39;year_first_hired&#39;]
</pre></div>
</div>
<p>After encoding (we only plot the first 8 feature names):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feature_names</span></a> <span class="o">=</span> <a href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer.get_feature_names" title="dirty_cat.SuperVectorizer.get_feature_names" class="sphx-glr-backref-module-dirty_cat sphx-glr-backref-type-py-method"><span class="n">sup_vec</span><span class="o">.</span><span class="n">get_feature_names</span></a><span class="p">()</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feature_names</span></a><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;division: management, highway, welfare&#39;, &#39;division: administration, operations, battalion&#39;, &#39;division: technology, division, safety&#39;, &#39;division: planning, security, recruit&#39;, &#39;division: district, patrol, squad&#39;, &#39;division: maintenance, facilities, downtown&#39;, &#39;division: supports, support, supportive&#39;, &#39;division: gaithersburg, transit, silver&#39;]
</pre></div>
</div>
<p>As we can see, it created a new column for each unique value.
This is because we used <a class="reference external" href="https://dirty-cat.github.io/stable/generated/dirty_cat.SimilarityEncoder.html#dirty_cat.SimilarityEncoder" title="(in dirty_cat v0.2.0a1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimilarityEncoder</span></code></a> on the column “division”,
which was classified as a high cardinality string variable.
(default values, see <a class="reference external" href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer" title="(in dirty_cat v0.2.0a1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SuperVectorizer</span></code></a>’s docstring).</p>
<p>In total, we have reasonnable number of encoded columns.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feature_names</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>56
</pre></div>
</div>
</div>
</div>
<div class="section" id="feature-importance-in-the-statistical-model">
<h3>Feature importance in the statistical model<a class="headerlink" href="#feature-importance-in-the-statistical-model" title="Permalink to this headline">¶</a></h3>
<p>In this section, we will train a regressor, and plot the feature importances</p>
<div class="topic">
<p class="topic-title">Note:</p>
<p>To minimize compute time, use the feature importances computed by the
<a class="reference external" href="https://scikit-learn.org/0.20/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor" title="(in scikit-learn v0.20.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code></a>, but you should prefer <code class="xref py py-func docutils literal notranslate"><span class="pre">permutation_importance()</span></code>
instead (which are less subject to biases)</p>
</div>
<p>First, let’s train the <a class="reference external" href="https://scikit-learn.org/0.20/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor" title="(in scikit-learn v0.20.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomForestRegressor</span></code></a>,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor" title="sklearn.ensemble.RandomForestRegressor" class="sphx-glr-backref-module-sklearn-ensemble sphx-glr-backref-type-py-class"><span class="n">RandomForestRegressor</span></a>
<a href="http://scikit-learn.org/0.20/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor" title="sklearn.ensemble.RandomForestRegressor" class="sphx-glr-backref-module-sklearn-ensemble sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">regressor</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor" title="sklearn.ensemble.RandomForestRegressor" class="sphx-glr-backref-module-sklearn-ensemble sphx-glr-backref-type-py-class"><span class="n">RandomForestRegressor</span></a><span class="p">()</span>
<a href="http://scikit-learn.org/0.20/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor.fit" title="sklearn.ensemble.RandomForestRegressor.fit" class="sphx-glr-backref-module-sklearn-ensemble sphx-glr-backref-type-py-method"><span class="n">regressor</span><span class="o">.</span><span class="n">fit</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_train_enc</span></a><span class="p">,</span> <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series" title="pandas.Series" class="sphx-glr-backref-module-pandas sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y_train</span></a><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>RandomForestRegressor()
</pre></div>
</div>
<p>Retreiving the feature importances</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">importances</span></a> <span class="o">=</span> <a href="http://scikit-learn.org/0.20/modules/generated/sklearn.ensemble.RandomForestRegressor.html#sklearn.ensemble.RandomForestRegressor.feature_importances_" title="sklearn.ensemble.RandomForestRegressor.feature_importances_" class="sphx-glr-backref-module-sklearn-ensemble sphx-glr-backref-type-py-attribute"><span class="n">regressor</span><span class="o">.</span><span class="n">feature_importances_</span></a>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">std</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.std.html#numpy.std" title="numpy.std" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">std</span></a><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">feature_importances_</span>
        <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">regressor</span><span class="o">.</span><span class="n">estimators_</span></a>
    <span class="p">],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">indices</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.argsort.html#numpy.argsort" title="numpy.argsort" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">argsort</span></a><span class="p">(</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">importances</span></a><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Plotting the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title" title="matplotlib.pyplot.title" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s2">&quot;Feature importances&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n</span></a> <span class="o">=</span> <span class="mi">20</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_indices</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">indices</span></a><span class="p">[:</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n</span></a><span class="p">]</span>
<a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">labels</span></a> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feature_names</span></a><span class="p">)[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_indices</span></a><span class="p">]</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.barh.html#matplotlib.pyplot.barh" title="matplotlib.pyplot.barh" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">barh</span></a><span class="p">(</span><span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n</span></a><span class="p">),</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">importances</span></a><span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_indices</span></a><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">std</span></a><span class="p">[</span><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_indices</span></a><span class="p">])</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.yticks.html#matplotlib.pyplot.yticks" title="matplotlib.pyplot.yticks" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">yticks</span></a><span class="p">(</span><span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n</span></a><span class="p">),</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">labels</span></a><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.tight_layout.html#matplotlib.pyplot.tight_layout" title="matplotlib.pyplot.tight_layout" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="Feature importances" class="sphx-glr-single-img" src="../_images/sphx_glr_02_dirty_categories_001.png" />
<p>We can deduce from this data that the three factors that define the
most the salary are: being hired for a long time, being a manager, and
having a permanent, full-time job :).</p>
<div class="topic">
<p class="topic-title">The SuperVectorizer automates preprocessing</p>
<p>As this notebook demonstrates, many preprocessing steps can be
automated by the <a class="reference external" href="https://dirty-cat.github.io/stable/generated/dirty_cat.SuperVectorizer.html#dirty_cat.SuperVectorizer" title="(in dirty_cat v0.2.0a1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SuperVectorizer</span></code></a>, and the resulting pipeline can still be
inspected, even with non-normalized entries.</p>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 1 minutes  21.869 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-gen-notes-02-dirty-categories-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/dirty-data-science/python/gh-pages?filepath=notes/gen_notes/02_dirty_categories.ipynb"><img alt="Launch binder" src="../_images/binder_badge_logo.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/ca6dd7e24a8a8cb413de49c288ef27e5/02_dirty_categories.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">02_dirty_categories.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/929bea25da2647246d4ca99dc1f131c6/02_dirty_categories.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">02_dirty_categories.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2021, Gaël Varoquaux.
      
      |
      <a href="../_sources/gen_notes/02_dirty_categories.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>